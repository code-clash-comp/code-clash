<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Code Clash 2025</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" href="logo.png">

  <!-- MOBILE-HAMBURGER STYLES (mobile-only) -->
  <style>
    /* show hamburger only on narrow screens */
    @media (max-width: 760px) {
      .nav-actions { display: none !important; }

      .hamburger {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 44px;
        height: 44px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.04);
        background: rgba(0,0,0,0.24);
        margin-left: 8px;
        cursor: pointer;
        transition: transform .12s ease, background .12s ease;
        color: #e8f6e8;
      }
      .hamburger:active { transform: translateY(1px); }
      .hamburger-box { display: inline-block; position: relative; width: 22px; height: 14px; }
      .hamburger-inner, .hamburger-inner::before, .hamburger-inner::after {
        display: block;
        position: absolute;
        height: 2px;
        width: 100%;
        background: currentColor;
        left: 0;
        transition: transform .18s ease, opacity .18s ease;
        border-radius: 2px;
      }
      .hamburger-inner { top: 50%; transform: translateY(-50%); }
      .hamburger-inner::before { content: ""; top: -7px; }
      .hamburger-inner::after  { content: ""; top: 7px; }

      .hamburger[aria-expanded="true"] .hamburger-inner { transform: rotate(45deg); }
      .hamburger[aria-expanded="true"] .hamburger-inner::before { transform: rotate(-90deg) translateX(-1px); top: 0; }
      .hamburger[aria-expanded="true"] .hamburger-inner::after  { opacity: 0; }

      .mobile-menu {
        position: absolute;
        top: calc(100% + 10px);
        right: 12px;
        min-width: 180px;
        background: rgba(12,12,12,0.96);
        border: 1px solid rgba(255,255,255,0.04);
        border-radius: 10px;
        box-shadow: 0 12px 40px rgba(0,0,0,0.6);
        padding: 8px;
        z-index: 1200;
        transform-origin: top right;
        opacity: 0;
        pointer-events: none;
        transform: scale(.96);
        transition: opacity .14s ease, transform .14s ease;
      }
      .mobile-menu[aria-hidden="false"]{ opacity: 1; transform: scale(1); pointer-events: auto; }

      .mobile-menu-inner { display: flex; flex-direction: column; gap:8px; }
      .mobile-menu-inner button {
        display: block;
        width: 100%;
        text-align: left;
        padding: 10px 12px;
        border-radius: 8px;
        border: none;
        background: transparent;
        color: #e8f6e8;
        font-family: var(--mono);
        font-weight:700;
        cursor: pointer;
      }

      .mobile-menu-inner .nav-actions-admin { color: rgba(181, 120, 255, 0.828); border-bottom: 1px dashed rgba(255,255,255,0.03); padding-bottom: 10px; }

      .mobile-menu-inner button:hover, .mobile-menu-inner button:focus {
        background: rgba(127,191,127,0.06);
        color: #bff0c4;
        outline: none;
      }

      /* ensure menu fits on very small screens */
      .mobile-menu { right: 8px; left: 8px; top: calc(100% + 8px); min-width: auto; }
    }
  </style>
</head>
<body>
  <div class="nav" style="position:relative;">
    <div class="nav-name">
      <h1 class="nav-name-title">&lt;/&gt; Code Clash 2025</h1>
    </div>

    <div class="nav-actions">
      <button id="navDashboard" style="display:none;" class="nav-actions-admin">Admin Panel</button>
      <button id="navRegister" class="nav-actions-register">Register</button>
      <button id="navLogin" class="nav-actions-login">Login</button>
    </div>

    <!-- mobile hamburger/menu (keeps DOM minimal on desktop) -->
    <button id="mobileMenuBtn" class="hamburger" aria-label="Toggle menu" aria-expanded="false" aria-controls="mobileMenu" style="display:none;">
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>

    <div id="mobileMenu" class="mobile-menu" role="menu" aria-hidden="true" style="display:none;">
      <div class="mobile-menu-inner" role="none"></div>
    </div>
  </div>

  <main class="main-stage">
    <section class="anim-stage" aria-labelledby="heroTitle">
      <div class="stage-inner">
        <div class="typebox">
          <h1 id="heroTitle" class="hero-title">&lt;/&gt; Code Clash 2025</h1>

          <!-- Welcome message (appears only when logged in) -->
          <h2 id="welcomeMsg" class="welcome-msg" style="display:none;"></h2>

          <div class="muted tagline">Fast. Fair. Friendly. — 1v1 duels, team points.</div>

          <div class="typing-line" aria-live="polite">
            <div id="typingText" class="typing-text"></div>
            <div class="cursor" aria-hidden="true"></div>
          </div>

          <div id="countdownPills" class="countdown" role="timer" aria-live="polite">
            <div class="cd-pill"><div class="bignum" id="cdDays">--</div><div class="lbl">Days</div></div>
            <div class="cd-pill"><div class="bignum" id="cdHours">--</div><div class="lbl">Hours</div></div>
            <div class="cd-pill"><div class="bignum" id="cdMins">--</div><div class="lbl">Minutes</div></div>
            <div class="cd-pill"><div class="bignum" id="cdSecs">--</div><div class="lbl">Seconds</div></div>
          </div>

          <div class="register-cta-wrapper">
            <button id="bigRegister" class="big-register">Register for Code Clash 2025</button>
            <div class="small muted" style="margin-top:10px">
              We'll reach out to you by E-mail or Whatsapp for contest updates.
            </div>
          </div>
        </div>

        <aside class="right-panel" aria-hidden="false">
          <div class="panel" id="infoPanel">
            <div class="panel-title">Event Info</div>

            <div class="info-flex">
              <div>
                <div class="small muted">Participants(max)</div>
                <div id="participantsCount" style="font-size:20px;font-weight:700;color:var(--accent)">32</div>
              </div>
              <div>
                <div class="small muted">Teams</div>
                <div id="teamsCount" style="font-size:20px;font-weight:700;color:var(--accent)">8</div>
              </div>
            </div>

            <div style="margin-top:12px">
              <div class="small muted">Live Registrations</div>
              <div id="liveReg" style="font-size:22px;font-weight:800;color:var(--accent)">0</div>
              <div class="small muted slots-left" style="margin-top:6px">Slots left: <span id="slotsLeft">32</span></div>

              <div class="progress" aria-hidden="true" style="margin-top:10px">
                <div class="progress-track" role="presentation">
                  <div class="progress-fill" id="progressFill" style="width:0%"></div>
                </div>
              </div>
            </div>
          </div>
        </aside>

      </div>
    </section>
  </main>

  <footer class="page-foot muted-no-margin">Hosted on GitHub Pages · Good luck and have fun!</footer>

  <!-- mobile menu helper script -->
  <!-- REPLACE previous mobile menu helper with this block -->
<script>
(function(){
  const btn = document.getElementById('mobileMenuBtn');
  const menu = document.getElementById('mobileMenu');
  const inner = document.querySelector('.mobile-menu-inner');
  const desktopActions = document.querySelector('.nav-actions');

  if(!btn || !menu || !inner) return;

  const canonicalIds = ['navDashboard','navRegister','navLogin'];

  function setMobileVisibility(){
    const mobile = window.innerWidth <= 760;
    btn.style.display = mobile ? 'inline-flex' : 'none';
    menu.style.display = mobile ? '' : 'none';
    if(!mobile){
      menu.setAttribute('aria-hidden','true');
      btn.setAttribute('aria-expanded','false');
    } else {
      buildMobileMenu();
    }
  }
  setMobileVisibility();
  window.addEventListener('resize', setMobileVisibility);

  // returns true if element has inline style display:none or hidden attribute
  function explicitlyHidden(el){
    if(!el) return true;
    if(el.hidden) return true;
    const s = (el.getAttribute('style') || '').toLowerCase();
    if(/\bdisplay\s*:\s*none\b/.test(s)) return true;
    return false;
  }

  // include canonical items even if CSS media rules hide desktop nav on mobile
  function shouldInclude(el){
    if(!el) return false;
    // explicit inline hiding => definitely exclude
    if(explicitlyHidden(el)) return false;
    // if it has attribute data-force-mobile="true" include
    if(el.getAttribute && el.getAttribute('data-force-mobile') === 'true') return true;
    // otherwise include by default (we want menu usable for unauthed users)
    return true;
  }

  // canonical action fallback (guaranteed navigation even if desktop handlers absent)
  function performCanonicalActionById(id){
    switch(id){
      case 'navRegister':
        window.location.href = 'register.html';
        return;
      case 'navLogin':
        window.location.href = 'login.html';
        return;
      case 'navDashboard':
        // prefer dashboard; if admin link is visible on desktop it will be shown separately
        window.location.href = 'dashboard.html';
        return;
      default:
        return;
    }
  }

  function proxyClickToOriginal(orig, menuBtn){
    // hide menu first
    menu.setAttribute('aria-hidden','true');
    btn.setAttribute('aria-expanded','false');

    // if original element has a direct onclick function, call it
    try {
      if(orig && typeof orig.onclick === 'function'){
        orig.onclick();
        return;
      }
      // if original has a data-action attribute, trust it (not common, but helpful)
      const dataAction = orig && orig.getAttribute && orig.getAttribute('data-action');
      if(dataAction){
        // common patterns: "logout", "open-dashboard" etc.
        if(dataAction === 'logout'){
          // try to trigger click (some pages attach handler to element)
          try { orig.click(); } catch(e){ /* ignore */ }
          return;
        }
      }
      // otherwise perform canonical fallback if available
      if(orig && orig.id && canonicalIds.includes(orig.id)){
        performCanonicalActionById(orig.id);
        return;
      }
      // last resort: call click() on the original to fire listeners attached via addEventListener
      if(orig && typeof orig.click === 'function'){
        orig.click();
        return;
      }
    } catch(err){
      console.error('Mobile menu proxy click failed', err);
    }
    // absolute fallback: do nothing (shouldn't happen)
  }

  function buildMobileMenu(){
    inner.innerHTML = '';

    // canonical items first (deterministic order)
    for(const id of canonicalIds){
      const orig = document.getElementById(id);
      // include if element exists AND not explicitly hidden
      if(!orig) continue;
      if(!shouldInclude(orig)) continue;

      const b = document.createElement('button');
      b.className = orig.className || '';
      b.textContent = (orig.getAttribute('aria-label') || orig.innerText || orig.textContent || id).trim();
      b.dataset.origId = id;
      b.addEventListener('click', (e) => proxyClickToOriginal(orig, b));
      inner.appendChild(b);
    }

    // then include any other visible buttons from .nav-actions (avoid duplicating canonical items)
    if(desktopActions){
      Array.from(desktopActions.children).forEach(orig => {
        if(!orig) return;
        if(orig.id && canonicalIds.includes(orig.id)) return;
        if(!shouldInclude(orig)) return;

        const b = document.createElement('button');
        b.className = orig.className || '';
        b.textContent = (orig.getAttribute('aria-label') || orig.innerText || orig.textContent || 'Action').trim();
        if(orig.id) b.dataset.origId = orig.id;
        b.addEventListener('click', (e) => proxyClickToOriginal(orig, b));
        inner.appendChild(b);
      });
    }

    if(inner.children.length === 0){
      const fallback = document.createElement('div');
      fallback.className = 'small-muted';
      fallback.textContent = 'No actions available';
      inner.appendChild(fallback);
    }
  }

  function openMenu(){
    buildMobileMenu();
    menu.setAttribute('aria-hidden','false');
    btn.setAttribute('aria-expanded','true');
    setTimeout(()=> document.addEventListener('click', outsideClick), 10);
    document.addEventListener('keydown', onKeyDown);
  }
  function closeMenu(){
    menu.setAttribute('aria-hidden','true');
    btn.setAttribute('aria-expanded','false');
    document.removeEventListener('click', outsideClick);
    document.removeEventListener('keydown', onKeyDown);
  }
  function outsideClick(e){
    if(menu.contains(e.target) || btn.contains(e.target)) return;
    closeMenu();
  }
  function onKeyDown(e){
    if(e.key === 'Escape') closeMenu();
  }

  btn.addEventListener('click', (ev)=>{
    ev.stopPropagation();
    const expanded = btn.getAttribute('aria-expanded') === 'true';
    if(expanded) closeMenu(); else openMenu();
  });

  // rebuild menu when desktopActions change
  const observer = new MutationObserver((mutations) => {
    if(window._menuRebuildTimer) clearTimeout(window._menuRebuildTimer);
    window._menuRebuildTimer = setTimeout(() => {
      if(window.innerWidth <= 760) buildMobileMenu();
    }, 60);
  });
  if(desktopActions) observer.observe(desktopActions, { childList: true, subtree: true, attributes: true, attributeFilter: ['style','class','hidden'] });

  // also listen for explicit nav-updated event
  document.addEventListener('nav-updated', () => {
    if(window.innerWidth <= 760) buildMobileMenu();
  });

  // initial build for mobile
  if(window.innerWidth <= 760) buildMobileMenu();

})();
</script>

<script type="module">
(async function(){
  // ---------- CONFIG ----------
  const target = new Date('2025-10-18T11:00:00').getTime();
  const MAX_PARTICIPANTS = 32;

  const phrases = [
    'Are you ready to duel?',
    'Fastest correct solution wins.',
    '1v1 duels — team points on the line.',
    'Sharpen your loops. Debug your logic.'
  ];

  // ---------- TYPING ANIMATION ----------
  (function typing(){
    const el = document.getElementById('typingText');
    if(!el) return;
    let p = 0, ch = 0, deleting = false;
    const typingSpeed = 45, pauseAfter = 900;
    function tick(){
      const cur = phrases[p];
      if(!deleting){
        el.textContent = cur.slice(0, ch+1);
        ch++;
        if(ch === cur.length){
          deleting = true;
          setTimeout(tick, pauseAfter);
          return;
        }
      } else {
        el.textContent = cur.slice(0, ch-1);
        ch--;
        if(ch === 0){
          deleting = false;
          p = (p+1) % phrases.length;
        }
      }
      setTimeout(tick, deleting ? typingSpeed/1.2 : typingSpeed);
    }
    tick();
  })();

  // ---------- COUNTDOWN ----------
  (function countdown(){
    const dEl = document.getElementById('cdDays');
    const hEl = document.getElementById('cdHours');
    const mEl = document.getElementById('cdMins');
    const sEl = document.getElementById('cdSecs');
    if(!dEl || !hEl || !mEl || !sEl) return;
    function update(){
      const now = Date.now();
      let diff = target - now;
      if(diff <= 0){
        dEl.textContent = '00'; hEl.textContent='00'; mEl.textContent='00'; sEl.textContent='00';
        return;
      }
      const secs = Math.floor(diff / 1000);
      const days = Math.floor(secs / 86400);
      const hours = Math.floor((secs % 86400) / 3600);
      const mins = Math.floor((secs % 3600) / 60);
      const s = secs % 60;
      dEl.textContent = String(days).padStart(2,'0');
      hEl.textContent = String(hours).padStart(2,'0');
      mEl.textContent = String(mins).padStart(2,'0');
      sEl.textContent = String(s).padStart(2,'0');
    }
    update();
    setInterval(update, 1000);
  })();

  // ---------- DOM refs ----------
  const navLogin = document.getElementById('navLogin');
  const navRegister = document.getElementById('navRegister');
  const navDashboard = document.getElementById('navDashboard'); // admin button (hidden by default)
  const bigReg = document.getElementById('bigRegister');
  const welcomeMsg = document.getElementById('welcomeMsg');

  const participantsEl = document.getElementById('participantsCount');
  const liveRegEl = document.getElementById('liveReg');
  const slotsLeftEl = document.getElementById('slotsLeft');
  const progressFill = document.getElementById('progressFill');

  // preserve expected classes so CSS styling persists
  if(navRegister && !navRegister.classList.contains('nav-actions-register')) navRegister.classList.add('nav-actions-register');
  if(navLogin && !navLogin.classList.contains('nav-actions-login')) navLogin.classList.add('nav-actions-login');

  // ---------- helpers ----------
  function doPulse(el){ if(!el) return; el.classList.add('pulse'); setTimeout(()=> el.classList.remove('pulse'), 420); }
  function updateCounterUI(count){
    if(participantsEl) participantsEl.textContent = String(MAX_PARTICIPANTS);
    if(liveRegEl) liveRegEl.textContent = String(count);
    const slotsLeft = Math.max(0, MAX_PARTICIPANTS - count);
    if(slotsLeftEl) slotsLeftEl.textContent = String(slotsLeft);
    const pct = Math.min(100, Math.round((count / MAX_PARTICIPANTS) * 100));
    if(progressFill) progressFill.style.width = pct + '%';
  }

  // ---------- Local fallback counter ----------
  function startLocalDemoCounter(){
    function getStoredCount(){ const n = parseInt(localStorage.getItem('cc_reg_count') || '0', 10); return Number.isNaN(n) ? 0 : n; }
    function setStoredCount(v){ localStorage.setItem('cc_reg_count', String(v)); }

    updateCounterUI(getStoredCount());

    // register button behavior increments once per session then navigates
    if(navRegister) navRegister.onclick = (e)=>{ doPulse(navRegister); if(sessionStorage.getItem('cc_registered')){ window.location.href='register.html'; return; } let cnt=getStoredCount(); if(cnt>=MAX_PARTICIPANTS) return; cnt++; setStoredCount(cnt); sessionStorage.setItem('cc_registered','1'); updateCounterUI(cnt); window.location.href='register.html'; };
    if(bigReg) bigReg.onclick = (e)=>{ doPulse(bigReg); if(sessionStorage.getItem('cc_registered')){ window.location.href='register.html'; return; } let cnt=getStoredCount(); if(cnt>=MAX_PARTICIPANTS) return; cnt++; setStoredCount(cnt); sessionStorage.setItem('cc_registered','1'); updateCounterUI(cnt); window.location.href='register.html'; };
    if(navLogin) navLogin.onclick = (e)=>{ doPulse(navLogin); window.location.href='login.html'; };
  }

  // ---------- FIREBASE (auth + live counter + admin button) ----------
  const FIREBASE_CONFIG = {
    apiKey: "AIzaSyDpKPIqiWrGpvE3xL6TBRQEEfrpZGIfedM",
    authDomain: "code-clash-2025.firebaseapp.com",
    projectId: "code-clash-2025",
    storageBucket: "code-clash-2025.firebasestorage.app",
    messagingSenderId: "13717806434",
    appId: "1:13717806434:web:8aa7799e7f87ebbdf0603b",
    measurementId: "G-0BMTHMYMEL"
  };

  async function startFirebase(){
    try {
      const [{ initializeApp }, { getFirestore, collection, onSnapshot, doc, getDoc }, { getAuth, onAuthStateChanged, signOut }] = await Promise.all([
        import('https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js'),
        import('https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js'),
        import('https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js')
      ]);

      const app = initializeApp(FIREBASE_CONFIG);
      const db = getFirestore(app);
      const auth = getAuth(app);

      // show/hide admin button helper
      async function resolveAdminForUser(user){
        if(!user) return false;
        // preferred: custom claims
        try {
          const idRes = await user.getIdTokenResult();
          const claims = idRes.claims || {};
          if(claims.admin || claims.isAdmin || claims.superAdmin || claims.isSuperAdmin) return true;
        } catch(e){
          console.warn('getIdTokenResult failed when checking claims:', e);
        }
        // fallback: users/{uid} doc fields
        try {
          const udoc = await getDoc(doc(db, 'users', user.uid));
          const data = udoc.exists() ? udoc.data() : {};
          if(data.isAdmin || data.isSuperAdmin) return true;
        } catch(e){
          console.warn('fallback user doc admin check failed:', e);
        }
        return false;
      }

      // live participant counter (exclude admins/superAdmin)
      onSnapshot(collection(db, 'users'), (snap) => {
        try {
          const docs = snap.docs.map(d => ({ uid: d.id, ...(d.data()||{}) }));
          const nonAdminCount = docs.filter(u => !u.isAdmin && !u.isSuperAdmin).length;
          updateCounterUI(nonAdminCount);
        } catch (err) {
          console.error('Error counting participants (filtered):', err);
          updateCounterUI(snap.size);
        }
      }, (err) => {
        console.error('Firestore snapshot error (counter):', err);
      });

      // ---- Optimistic welcome placeholder to avoid flicker ----
      if(welcomeMsg){
        welcomeMsg.textContent = 'Welcome,';
        welcomeMsg.style.display = 'block';
      }

      // onAuthStateChanged: update UI + admin button visibility
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          // Force-refresh ID token to verify validity
          try {
            await user.getIdToken(true);
          } catch (tokenErr) {
            console.warn('Token refresh failed; signing out to clear stale session:', tokenErr);
            try { await signOut(auth); } catch(e){ console.error('signOut failed', e); }
            return;
          }

          // update basic auth UI
          if(navRegister){
            navRegister.textContent = 'Dashboard';
            navRegister.onclick = ()=>{ doPulse(navRegister); window.location.href = 'dashboard.html'; };
          }
          if(navLogin){
            navLogin.textContent = 'Logout';
            navLogin.onclick = async ()=> {
              doPulse(navLogin);
              const confirmed = confirm('Are you sure you want to log out?');
              if(!confirmed) return;
              try { await signOut(auth); } catch(e){ console.error(e); }
            };
          }
          if(bigReg){
            bigReg.textContent = 'Go to Dashboard';
            bigReg.onclick = ()=>{ doPulse(bigReg); window.location.href = 'dashboard.html'; };
          }

          // welcome name
          if(welcomeMsg){
            const name = user.displayName || user.email || 'Participant';
            welcomeMsg.textContent = `Welcome, ${name}`;
            welcomeMsg.style.display = 'block';
          }

          // check admin claims / doc, show admin button if allowed
          const isAdminUser = await resolveAdminForUser(user);
          if(isAdminUser && navDashboard){
            navDashboard.style.display = 'inline-block';
            navDashboard.onclick = ()=> { doPulse(navDashboard); window.location.href = 'admin.html'; };
          } else if(navDashboard) {
            navDashboard.style.display = 'none';
            navDashboard.onclick = null;
          }

          // rebuild mobile menu to reflect current nav visibility (important)
          try { document.querySelector('.hamburger').style.display && document.querySelector('.hamburger').style.display !== 'none' ? (()=>{/*noop*/})() : null; } catch(e){}
          // dispatch a small custom event to notify mobile menu script (or rely on mutation observer which also listens attribute changes)
          const ev = new Event('nav-updated');
          document.dispatchEvent(ev);

        } else {
          // not logged in: revert to logged-out UI
          if(navRegister){
            navRegister.textContent = 'Register';
            navRegister.onclick = ()=>{ doPulse(navRegister); window.location.href = 'register.html'; };
          }
          if(navLogin){
            navLogin.textContent = 'Login';
            navLogin.onclick = ()=>{ doPulse(navLogin); window.location.href = 'login.html'; };
          }
          if(bigReg){
            bigReg.textContent = 'Register for Code Clash 2025';
            bigReg.onclick = ()=>{ doPulse(bigReg); window.location.href = 'register.html'; };
          }
          if(welcomeMsg){
            welcomeMsg.textContent = '';
            welcomeMsg.style.display = 'none';
          }
          if(navDashboard) navDashboard.style.display = 'none';
          // notify menu
          document.dispatchEvent(new Event('nav-updated'));
        }
      });

      // also listen for the custom event to rebuild mobile menu (ensures immediate reflection)
      document.addEventListener('nav-updated', ()=>{
        // only rebuild when mobile menu exists
        try {
          if(window.innerWidth <= 760) {
            // call the mobile menu builder function by dispatching a click to hamburger (open->close pattern would rebuild via observer)
            // but we can simply find the function's buildMobileMenu via the global scope — not available — so we'll simulate by toggling a trivial mutation:
            const navActions = document.querySelector('.nav-actions');
            if(navActions){
              // mutate a temporary attribute to trigger MutationObserver used by mobile menu
              navActions.setAttribute('data-menu-refresh', Date.now().toString());
              setTimeout(()=> navActions.removeAttribute('data-menu-refresh'), 50);
            }
          }
        } catch(e){ console.warn('nav-updated handler error', e); }
      });

    } catch (err) {
      console.warn('Firebase initialization failed — falling back to local demo behavior:', err);
      // fallback to local demo if Firebase cannot start
      startLocalDemoCounter();
      // basic nav behavior when Firebase unavailable
      if(navRegister) navRegister.onclick = ()=>{ doPulse(navRegister); window.location.href = 'register.html'; };
      if(navLogin) navLogin.onclick = ()=>{ doPulse(navLogin); window.location.href = 'login.html'; };
      if(bigReg) bigReg.onclick = ()=>{ doPulse(bigReg); window.location.href = 'register.html'; };
      if(navDashboard) navDashboard.style.display = 'none';
    }
  }

  // ---------- start ----------
  await startFirebase();

})();
</script>

</body>
</html>
